# README - Serveur DASH

## Description

Ce rÃ©pertoire contient le code source et les configurations nÃ©cessaires pour mettre en Å“uvre le **serveur DASH** du projet de streaming adaptatif. Le serveur est basÃ© sur **Node.js** et **Express**, et il sert les fichiers vidÃ©o segmentÃ©s ainsi que le fichier MPD (Media Presentation Description) aux clients.

Le serveur est Ã©galement capable de simuler des variations de bande passante et de latence Ã  l'aide de scripts shell qui utilisent l'outil `tc` (Traffic Control). Ces simulations permettent de tester la robustesse de notre algorithme d'adaptation personnalisÃ©.

---

## Structure du RÃ©pertoire

Voici l'arborescence du rÃ©pertoire :

```
dash-server/
â”œâ”€â”€ LocalFiles/
â”‚   â””â”€â”€ videos/
â”‚       â”œâ”€â”€ chunk-stream*.m4s
â”‚       â”œâ”€â”€ init-stream*.m4s
â”‚       â””â”€â”€ manifest.mpd
â”œâ”€â”€ node_modules/
â”œâ”€â”€ .gitignore
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ README.MD
â”œâ”€â”€ server.js
â”œâ”€â”€ simulate_bandwidth_drop_Container.sh
â”œâ”€â”€ simulate_bandwidth_drop_VM.sh
â””â”€â”€ simulate_bandwidth_latency_drop_Container.sh
```

### Description des Fichiers et RÃ©pertoires

- **LocalFiles/** : Contient les fichiers vidÃ©o segmentÃ©s (`chunk-stream*.m4s`, `init-stream*.m4s`) et le fichier MPD (`manifest.mpd`) gÃ©nÃ©rÃ©s avec FFmpeg.
- **node_modules/** : RÃ©pertoire contenant les dÃ©pendances Node.js installÃ©es automatiquement via `npm install`.
- **.gitignore** : Fichier spÃ©cifiant les fichiers ou rÃ©pertoires Ã  ignorer par Git.
- **Dockerfile** : Configuration pour construire l'image Docker du serveur.
- **package-lock.json** & **package.json** : Fichiers de configuration pour les dÃ©pendances Node.js.
- **server.js** : Code principal du serveur DASH, basÃ© sur Express.
- **simulate_bandwidth_drop_Container.sh** : Script pour simuler une rÃ©duction progressive de la bande passante dans le conteneur.
- **simulate_bandwidth_drop_VM.sh** : Script pour simuler une rÃ©duction de la bande passante directement sur la machine hÃ´te.
- **simulate_bandwidth_latency_drop_Container.sh** : Script combinant la simulation de rÃ©duction de bande passante et d'augmentation de latence dans le conteneur.

---

## Instructions d'Installation et de Lancement

### PrÃ©requis

Assurez-vous d'avoir les outils suivants installÃ©s :

- **Docker** (version 20.10 ou supÃ©rieure)
- **FFmpeg** (pour gÃ©nÃ©rer les fichiers DASH)

---

### Ã‰tapes de DÃ©ploiement

1. **Clonez le dÃ©pÃ´t** :
   ```bash
   cd votre-repo/dash-server
   ```

2. **Construisez l'image Docker** :
   ```bash
   docker build -t dash-server .
   ```

3. **DÃ©marrez le conteneur** :
   ```bash
   docker run -d --name dash-server -p 3000:3000 dash-server
   ```

4. **VÃ©rifiez que le serveur est opÃ©rationnel** :
   AccÃ©dez Ã  [http://localhost:3000](http://localhost:3000) dans votre navigateur. Vous devriez voir une page HTML avec un lecteur vidÃ©o prÃ©configurÃ© pour lire le flux DASH.

---

### GÃ©nÃ©ration des Fichiers DASH

Pour gÃ©nÃ©rer les fichiers vidÃ©o segmentÃ©s et le fichier MPD, utilisez FFmpeg avec la commande suivante :

```bash
ffmpeg -i video.mp4 \
  -c:v libx264 -b:v 5000k -maxrate 5000k -bufsize 5000k -vf "scale=1920:1080" -g 48 -keyint_min 48 -sc_threshold 0 -c:a aac -b:a 128k -f dash chunk-stream7_%d.m4s \
  -c:v libx264 -b:v 3000k -maxrate 3000k -bufsize 3000k -vf "scale=1280:720" -g 48 -keyint_min 48 -sc_threshold 0 -c:a aac -b:a 128k -f dash chunk-stream6_%d.m4s \
  -init_seg_name 'init-stream$RepresentationID$.m4s' \
  -media_seg_name 'chunk-stream$RepresentationID$-$Number%.m4s' \
  -é€‚åº”æ€§æµåª’ä½“è¾“å‡º manifest.mpd
```

Placez les fichiers gÃ©nÃ©rÃ©s dans le rÃ©pertoire `LocalFiles/videos`.

---

### Simulation des Variations de RÃ©seau

#### 1. Simuler une RÃ©duction de Bande Passante dans le Conteneur

ExÃ©cutez le script `simulate_bandwidth_drop_Container.sh` depuis le terminal :

```bash
docker exec -it dash-server bash
./simulate_bandwidth_drop_Container.sh
```

#### 2. Simuler une RÃ©duction de Bande Passante sur la Machine HÃ´te

ExÃ©cutez le script `simulate_bandwidth_drop_VM.sh` directement sur la machine hÃ´te :

```bash
./simulate_bandwidth_drop_VM.sh
```

#### 3. Simuler une RÃ©duction de Bande Passante et une Augmentation de Latence dans le Conteneur

ExÃ©cutez le script `simulate_bandwidth_latency_drop_Container.sh` depuis le terminal :

```bash
docker exec -it dash-server bash
./simulate_bandwidth_latency_drop_Container.sh
```

---

## FonctionnalitÃ©s ClÃ©s

1. **Service de Fichiers Statiques** :
   - Le serveur expose les fichiers vidÃ©o segmentÃ©s et le fichier MPD via HTTP.

2. **Route Principale** :
   - Une route `/` est dÃ©finie pour fournir une page HTML simple contenant un lecteur vidÃ©o configurÃ© pour lire le flux DASH.

3. **Support CORS** :
   - Le serveur inclut une configuration CORS pour autoriser les requÃªtes provenant du client React.

---

## Contributions

Les contributions sont les bienvenues ! Pour contribuer, suivez ces Ã©tapes :

1. Clonez le dÃ©pÃ´t.
2. CrÃ©ez une branche pour vos modifications (`git checkout -b feature/nom-de-votre-feature`).
3. Soumettez vos changements (`git commit -m "Description de votre modification"`).
4. Envoyez une pull request.


## Remerciements

Nous remercions l'Ã©quipe enseignante du Master 1 GÃ©nie Informatique pour leur soutien et leurs prÃ©cieux conseils tout au long de ce projet.

--- 

Si vous avez des questions ou besoin d'aide, n'hÃ©sitez pas Ã  nous contacter ! ğŸ˜Š